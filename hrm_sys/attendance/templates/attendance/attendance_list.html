{% extends "configs/base.html" %}
{% load static %}
{% load attendance_extras %}


{% block content %}
  {% include 'configs/partials/sidebar.html' %}

  <main class="ease-soft-in-out xl:ml-68.5 relative h-full max-h-screen rounded-xl transition-all duration-200">
    {% include 'configs/partials/main-top-nav.html' %}

    <!-- Page Container -->
    <section class="max-w-7xl mx-auto bg-white shadow rounded-xl p-4 sm:p-6 mt-6">
      <!-- Header -->
      <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-2">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">ğŸ“‹ Attendance Records</h2>
        <span class="text-xs sm:text-sm text-gray-500">Search and review attendance history</span>
      </header>

      <!-- Summary Bar -->
      <!-- Summary Bar -->
<!-- Summary Bar -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
  <!-- Total Records -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center gap-3">
    <span class="text-2xl">ğŸ“Š</span>
    <div>
      <p class="text-sm text-gray-500">Total Records (This Month)</p>
      <p class="text-lg font-bold text-blue-700">{{ attendances|current_month|length }}</p>
    </div>
  </div>

  <!-- Late Check-ins -->
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3">
    <span class="text-2xl">âš ï¸</span>
    <div>
      <p class="text-sm text-gray-500">Late Check-ins (This Month)</p>
      <p class="text-lg font-bold text-red-700">
        {{ attendances|current_month|count_true:"is_late_check_in" }}
      </p>
    </div>
  </div>

  <!-- Early Check-outs -->
  <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center gap-3">
    <span class="text-2xl">â³</span>
    <div>
      <p class="text-sm text-gray-500">Early Check-outs (This Month)</p>
      <p class="text-lg font-bold text-yellow-700">
        {{ attendances|current_month|count_true:"is_early_check_out" }}
      </p>
    </div>
  </div>
</div>>

      <!-- Sticky Search Bar -->
      <div class="sticky top-0 z-20 bg-white border-b border-gray-200 px-3 py-2 sm:px-4 sm:py-3 mb-6">
        <form hx-get="{% url 'attendance-list' %}"
              hx-target="#attendance-container"
              hx-trigger="keyup changed delay:300ms from:input[name='search']"
              hx-swap="innerHTML"
              onsubmit="return false;"
              class="flex flex-col sm:flex-row gap-2 sm:gap-3">
          <input type="text" name="search" value="{{ request.GET.search }}"
                 placeholder="ğŸ” Search by employee name, code, or date..."
                 class="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
          <button type="button"
                  class="px-3 sm:px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition">
            Search
          </button>
        </form>
      </div>

      <!-- Attendance Table Container -->
      <div id="attendance-container">
        {% include "attendance/partials/attendance_table.html" %}
      </div>

      <!-- Spinner -->
      <div id="spinner" class="htmx-indicator hidden mt-6 text-center">
        <svg class="animate-spin h-6 w-6 text-blue-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-25"/>
          <path class="opacity-75" stroke-width="4" d="M4 12a8 8 0 018-8"/>
        </svg>
        <p class="text-xs sm:text-sm text-gray-500 mt-2">Loading attendance...</p>
      </div>
    </section>
  </main>
{% endblock %}