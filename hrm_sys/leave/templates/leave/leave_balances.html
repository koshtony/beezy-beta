{% extends "configs/base.html" %}
{% load static %}

{% block content %}
  {% include 'configs/partials/sidebar.html' %}

  <main class="ease-soft-in-out xl:ml-68.5 relative h-full max-h-screen rounded-xl transition-all duration-200">
    {% include 'configs/partials/main-top-nav.html' %}

    <div class="bg-white rounded-xl shadow p-6 sm:p-8 max-w-7xl w-full mx-auto mt-6">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800">Leave Balances & History</h2>

      <!-- Spinner -->
      <div id="spinner" class="htmx-indicator hidden text-center py-2">
        <svg class="animate-spin h-6 w-6 text-blue-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-25" />
          <path class="opacity-75" stroke-width="4" d="M4 12a8 8 0 018-8" />
        </svg>
      </div>

      <!-- Search Bar -->
      <form hx-get="{% url 'leave-balances' %}"
            hx-target="#leave-data"
            hx-indicator="#spinner"
            class="flex flex-col sm:flex-row gap-2 mb-6">
        <input type="text" name="search" value="{{ search }}"
               placeholder="Search by employee or leave type..."
               class="flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button type="submit"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          Search
        </button>
      </form>

      <!-- Tables Section -->
      <div id="leave-data">
        {% include "leave/partials/leave_balances_tables.html" %}
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/htmx.org@1.9.3"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x" defer></script>
  <script>
    document.addEventListener('htmx:afterSwap', function (e) {
      if (e.detail.target && window.Alpine && typeof Alpine.initTree === 'function') {
        Alpine.initTree(e.detail.target);
      }
    });
    document.addEventListener('htmx:load', function (e) {
      if (window.Alpine && typeof Alpine.initTree === 'function') {
        Alpine.initTree(e.target);
      }
    });
  </script>
  <style>[x-cloak]{display:none!important}</style>
{% endblock %}