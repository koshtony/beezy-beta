{% extends "configs/base.html" %}
{% load static %}

{% block content %}

{% include 'configs/partials/sidebar.html' %}

<main class="ease-soft-in-out xl:ml-68.5 relative h-full max-h-screen rounded-xl transition-all duration-200">

    {% include 'configs/partials/main-top-nav.html' %}

    <div class="w-full px-4 sm:px-6 py-6 mx-auto">

        <div class="max-w-2xl mx-auto" id="edit-approval-container">

            <!-- Card -->
            <div class="bg-white shadow-md rounded-xl p-6">

                <!-- Header -->
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-xl font-bold text-gray-800">Edit Approval</h1>

                    <a href="{% url 'my-created-approvals' %}"
                       class="text-sm text-blue-600 hover:underline">
                        ‚Üê Back
                    </a>
                </div>
                {{editable}}
                <!-- If not editable -->
                {% if not editable %}
                <div class="bg-red-100 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">
                    This approval cannot be edited because it has been approved at a stage.
                </div>
                {% endif %}

                <!-- HTMX Success Message (appears after save) -->
                <div id="edit-alert"></div>

                <!-- Form -->
                <form
                    method="POST"
                    enctype="multipart/form-data"
                    hx-post="{% url 'edit-approval' approval.id %}"
                    hx-target="#edit-alert"
                    hx-swap="innerHTML"
                    hx-indicator="#save-spinner"
                    class="space-y-4"
                >
                    {% csrf_token %}

                    <!-- Approval Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Approval Type
                        </label>
                        <input type="text"
                               value="{{ approval.approval_type.name }}"
                               disabled
                               class="w-full px-3 py-2 border rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed">
                    </div>

                    <!-- Requested By -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Requested By
                        </label>
                        <input type="text"
                               value="{{ approval.creator.full_name }}"
                               disabled
                               class="w-full px-3 py-2 border rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed">
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description / Reason</label>
                        <textarea name="description"
                                  rows="4"
                                  class="w-full px-3 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                  {% if not editable %}disabled{% endif %}>{{ approval.description }}</textarea>
                    </div>

                    <!-- Attachment -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Attach Document (Optional)</label>
                        <input type="file"
                               name="attachment"
                               class="w-full text-sm"
                               {% if not editable %}disabled{% endif %}>
                    </div>

                    <!-- Buttons -->
                    <div class="pt-4 flex justify-end gap-3">
                        <a href="{% url 'my-created-approvals' %}"
                           class="px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 text-sm">
                            Cancel
                        </a>

                        <button type="submit"
                                class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm hover:bg-blue-700 transition
                                {% if not editable %}opacity-40 cursor-not-allowed{% endif %}"
                                {% if not editable %}disabled{% endif %}>
                            <span id="save-spinner" class="htmx-indicator">
                                <svg class="animate-spin h-4 w-4 mr-2 inline-block text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke-width="4"></circle>
                                    <path class="opacity-75" stroke-width="4" d="M4 12a8 8 0 018-8"></path>
                                </svg>
                            </span>
                            Save Changes
                        </button>
                    </div>
                </form>

            </div>
        </div>

    </div>

</main>

{% endblock %}
